
<form class="layui-form" lay-filter="layuiadmin-case-form"
	id="layuiadmin-case-form" style="padding: 20px 30px 0 0;">
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="案例标题"><span class="red-star">*</span></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          <input type="text" name="title" value="{{ d.params.title || '' }}" lay-verify="required" placeholder="{{ shiant.l("请输入") }}{{ shiant.l("案例标题") }}" autocomplete="off" class="layui-input">
        </script>
		</div>
	</div>
	<div class="layui-form-item">
      <label class="layui-form-label lang" data-lang="案例封面"><span class="red-star">*</span></label>
      <div class="layui-input-inline" >
	  	<div class="layui-upload">
     		<button type="button" class="layui-btn lang" id="cover-upload" data-lang="上传图片"></button>
       		<div class="layui-upload-list">
      			<img class="layui-upload-img" id="cover-upload-img" style="width: 200px;" src="">
          		<p id="cover-upload-text"></p>
       		</div>
    	</div> 
     	<script type="text/html" template>
			<input type="text" name="coverFile" value="{{ d.params.coverFile || '' }}" class="layui-input" style="display: none;">
        </script>
      </div>
    </div>
    <div class="layui-form-item">
      <div class="lang" data-lang="温馨提示" style="color: #c2c2c2;margin:10px 0;padding-left: 100px;"></div>
    </div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="案例正文"><span class="red-star">*</span></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          		<textarea id="content" type="text" name="content" lay-verify="content" placeholder="{{ shiant.l("请输入") }}{{ shiant.l("案例正文") }}" autocomplete="off" class="layui-textarea">{{ d.params.content || '' }}</textarea>
        	</script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="同学名称"><span class="red-star">*</span></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          <input type="text" name="studentName" value="{{ d.params.studentName || '' }}" lay-verify="required" placeholder="{{ shiant.l("请输入") }}{{ shiant.l("同学名称") }}" autocomplete="off" class="layui-input">
        </script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="录取学校"><span class="red-star">*</span></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          <input type="text" name="school" value="{{ d.params.school || '' }}" lay-verify="required" placeholder="{{ shiant.l("请输入") }}{{ shiant.l("录取学校") }}" autocomplete="off" class="layui-input">
        </script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="录取专业"><span class="red-star">*</span></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          <input type="text" name="major" value="{{ d.params.major || '' }}" lay-verify="required" placeholder="{{ shiant.l("请输入") }}{{ shiant.l("录取专业") }}" autocomplete="off" class="layui-input">
        </script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="分数成绩"><span class="red-star">*</span></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          <input type="text" name="grade" value="{{ d.params.grade || '' }}" lay-verify="required" placeholder="{{ shiant.l("请输入") }}{{ shiant.l("分数成绩") }}" autocomplete="off" class="layui-input">
        </script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="关联顾问"></label>
		<div class="layui-input-block">
			<div id="adviser-list"></div>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="排序"></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          		<input type="number" name="order" value="{{ d.params.order || 1 }}" autocomplete="off" class="layui-input">
        	</script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="阅读量"></label>
		<div class="layui-input-block">
			<script type="text/html" template>
          		<input type="number" name="showTime" value="{{ d.params.showTime || 0 }}" autocomplete="off" class="layui-input">
        	</script>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label lang" data-lang="上架设置"></label>
		<div class="layui-input-block">
			<input type="checkbox" name="public" lay-skin="switch" checked>
	    </div>
	</div>
	<script type="text/html" template>
      <input type="hidden" name="cid" value="{{ d.params.cid || '' }}">
    </script>
	<div class="layui-form-item">
		<label class="layui-form-label"></label>
		<div class="layui-input-inline">
			<input type="button" lay-submit
				lay-filter="layuiadmin-case-form-submit" value="确认"
				class="layui-btn">
		</div>
	</div>
</form>
<script type="text/html" template lay-done="layui.data.sendParams(d.params)">
</script>
<script>
layui.data.sendParams = function(params){
	layui.use([ 'admin', 'upload', 'form', 'layedit', 'xmSelect' ], function() {
	    upload = layui.upload
		layarea = layui.layarea;
	    layedit = layui.layedit;
	    xmSelect = layui.xmSelect;
		form = layui.form;
		
		/* debugger;
		form.val('layuiadmin-case-form', {"content": params.content});
		$('textarea[name="content"]').val(params.content); */

	    var uploadImgInst = upload.render({
	      elem: '#cover-upload'
	      ,url: shiant.getResHttpPrefix()+'/image?path=/study/management/case/cover'
	      ,accept: 'images' //只允许上传图片
	      ,acceptMime: 'image/*' //只筛选图片
	      ,size: 1024*3 //限定大小 单位 KB
	      ,before: function(obj){
	    	layer.msg(shiant.l("上传中"),{time:200000});
	        //预读本地文件示例，不支持ie8
	        obj.preview(function(index, file, result){
	          $('#cover-upload-img').attr('src', result); //图片链接（base64）
	        });
	      }
	      ,done: function(res){
	        //如果上传失败
	        if(res.code > 0){
	          return layer.msg(shiant.l('上传失败'));
	        }
	        layer.close(layer.index);
	        //上传成功
	        $('input[name="coverFile"]').val(res.url);
	      }
	      ,error: function(){
	        //演示失败状态，并实现重传
	        var demoText = $('#cover-upload-text');
	        demoText.html('<span style="color: #FF5722;">'+shiant.l("上传失败")+'</span> <a class="layui-btn layui-btn-mini cover-reload">'+shiant.l("重试")+'</a>');
	        demoText.find('.cover-reload').on('click', function(){
	        	uploadImgInst.upload();
	        });
	      }
	    });
	    
	    initFormTypeData = function () {
			$.ajax({
				url:layui.setter.url+'/service/adviser/getCurBeans?page=1&limit=100',
				type:"GET",
				dataType:"json",
				success:function(data){
					var list = [];
					for(var i=0;i<data.data.length;i++){
						list.push({
							"name":data.data[i].name,
							"value":data.data[i].aid,
						});
					}
					var adviserlist = xmSelect.render({
					    el: '#adviser-list', 
					    name: 'aids',
					    autoRow:true,
					    data: list
					})
					if(params.cid != null){
						$.ajax({
							url:layui.setter.url+'/service/adviser/getBeansByCid?cid='+params.cid,
							type:"GET",
							dataType:"json",
							success:function(data){
								if(data.status){
									var list = [];
									for(var i=0;i<data.bean.length;i++){
										list.push(data.bean[i].aid);
									}
									adviserlist.setValue(list);
								}
							},
							error:function(data){
								layer.msg(shiant.l(data.msg));
							}
						});
					}
				},
				error:function(data){
					layer.msg(shiant.l(data.msg));
				}
			});
		}
	   initFormTypeData();
	});
}
</script>
